"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // Key map
  var ENTER = 13;
  var ESCAPE = 27;
  var SPACE = 32;
  var UP = 38;
  var DOWN = 40;
  var TAB = 9;

  function closest(element, selector) {
    if (Element.prototype.closest) {
      return element.closest(selector);
    }

    do {
      if (Element.prototype.matches && element.matches(selector) || Element.prototype.msMatchesSelector && element.msMatchesSelector(selector) || Element.prototype.webkitMatchesSelector && element.webkitMatchesSelector(selector)) {
        return element;
      }

      element = element.parentElement || element.parentNode;
    } while (element !== null && element.nodeType === 1);

    return null;
  } // social share popups


  Array.prototype.forEach.call(document.querySelectorAll('.share a'), function (anchor) {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      window.open(this.href, '', 'height = 500, width = 500');
    });
  }); // In some cases we should preserve focus after page reload

  function saveFocus() {
    var activeElementId = document.activeElement.getAttribute('id');
    sessionStorage.setItem('returnFocusTo', '#' + activeElementId);
  }

  var returnFocusTo = sessionStorage.getItem('returnFocusTo');

  if (returnFocusTo) {
    sessionStorage.removeItem('returnFocusTo');
    var returnFocusToEl = document.querySelector(returnFocusTo);
    returnFocusToEl && returnFocusToEl.focus && returnFocusToEl.focus();
  } // show form controls when the textarea receives focus or backbutton is used and value exists


  var commentContainerTextarea = document.querySelector('.comment-container textarea'),
      commentContainerFormControls = document.querySelector('.comment-form-controls, .comment-ccs');

  if (commentContainerTextarea) {
    commentContainerTextarea.addEventListener('focus', function focusCommentContainerTextarea() {
      commentContainerFormControls.style.display = 'block';
      commentContainerTextarea.removeEventListener('focus', focusCommentContainerTextarea);
    });

    if (commentContainerTextarea.value !== '') {
      commentContainerFormControls.style.display = 'block';
    }
  } // Expand Request comment form when Add to conversation is clicked


  var showRequestCommentContainerTrigger = document.querySelector('.request-container .comment-container .comment-show-container'),
      requestCommentFields = document.querySelectorAll('.request-container .comment-container .comment-fields'),
      requestCommentSubmit = document.querySelector('.request-container .comment-container .request-submit-comment');

  if (showRequestCommentContainerTrigger) {
    showRequestCommentContainerTrigger.addEventListener('click', function () {
      showRequestCommentContainerTrigger.style.display = 'none';
      Array.prototype.forEach.call(requestCommentFields, function (e) {
        e.style.display = 'block';
      });
      requestCommentSubmit.style.display = 'inline-block';

      if (commentContainerTextarea) {
        commentContainerTextarea.focus();
      }
    });
  } // Mark as solved button


  var requestMarkAsSolvedButton = document.querySelector('.request-container .mark-as-solved:not([data-disabled])'),
      requestMarkAsSolvedCheckbox = document.querySelector('.request-container .comment-container input[type=checkbox]'),
      requestCommentSubmitButton = document.querySelector('.request-container .comment-container input[type=submit]');

  if (requestMarkAsSolvedButton) {
    requestMarkAsSolvedButton.addEventListener('click', function () {
      requestMarkAsSolvedCheckbox.setAttribute('checked', true);
      requestCommentSubmitButton.disabled = true;
      this.setAttribute('data-disabled', true); // Element.closest is not supported in IE11

      closest(this, 'form').submit();
    });
  } // Change Mark as solved text according to whether comment is filled


  var requestCommentTextarea = document.querySelector('.request-container .comment-container textarea');
  var usesWysiwyg = requestCommentTextarea && requestCommentTextarea.dataset.helper === 'wysiwyg';

  function isEmptyPlaintext(s) {
    return s.trim() === '';
  }

  function isEmptyHtml(xml) {
    var doc = new DOMParser().parseFromString("<_>".concat(xml, "</_>"), 'text/xml');
    var img = doc.querySelector('img');
    return img === null && isEmptyPlaintext(doc.children[0].textContent);
  }

  var isEmpty = usesWysiwyg ? isEmptyHtml : isEmptyPlaintext;

  if (requestCommentTextarea) {
    requestCommentTextarea.addEventListener('input', function () {
      if (isEmpty(requestCommentTextarea.value)) {
        if (requestMarkAsSolvedButton) {
          requestMarkAsSolvedButton.innerText = requestMarkAsSolvedButton.getAttribute('data-solve-translation');
        }

        requestCommentSubmitButton.disabled = true;
      } else {
        if (requestMarkAsSolvedButton) {
          requestMarkAsSolvedButton.innerText = requestMarkAsSolvedButton.getAttribute('data-solve-and-submit-translation');
        }

        requestCommentSubmitButton.disabled = false;
      }
    });
  } // Disable submit button if textarea is empty


  if (requestCommentTextarea && isEmpty(requestCommentTextarea.value)) {
    requestCommentSubmitButton.disabled = true;
  } // Submit requests filter form on status or organization change in the request list page


  Array.prototype.forEach.call(document.querySelectorAll('#request-status-select, #request-organization-select'), function (el) {
    el.addEventListener('change', function (e) {
      e.stopPropagation();
      saveFocus();
      closest(this, 'form').submit();
    });
  }); // Submit requests filter form on search in the request list page

  var quickSearch = document.querySelector('#quick-search');
  quickSearch && quickSearch.addEventListener('keyup', function (e) {
    if (e.keyCode === ENTER) {
      e.stopPropagation();
      saveFocus();
      closest(this, 'form').submit();
    }
  });

  function toggleNavigation(toggle, menu) {
    var isExpanded = menu.getAttribute('aria-expanded') === 'true';
    menu.setAttribute('aria-expanded', !isExpanded);
    toggle.setAttribute('aria-expanded', !isExpanded);
  }

  function closeNavigation(toggle, menu) {
    menu.setAttribute('aria-expanded', false);
    toggle.setAttribute('aria-expanded', false);
    toggle.focus();
  }

  var burgerMenu = document.querySelector('.header .menu-button');
  var userMenu = document.querySelector('#user-nav');
  burgerMenu.addEventListener('click', function (e) {
    e.stopPropagation();
    toggleNavigation(this, userMenu);
  });
  userMenu.addEventListener('keyup', function (e) {
    if (e.keyCode === ESCAPE) {
      e.stopPropagation();
      closeNavigation(burgerMenu, this);
    }
  });

  if (userMenu.children.length === 0) {
    burgerMenu.style.display = 'none';
  } // Toggles expanded aria to collapsible elements


  var collapsible = document.querySelectorAll('.collapsible-nav, .collapsible-sidebar');
  Array.prototype.forEach.call(collapsible, function (el) {
    var toggle = el.querySelector('.collapsible-nav-toggle, .collapsible-sidebar-toggle');
    el.addEventListener('click', function (e) {
      toggleNavigation(toggle, this);
    });
    el.addEventListener('keyup', function (e) {
      if (e.keyCode === ESCAPE) {
        closeNavigation(toggle, this);
      }
    });
  }); // Submit organization form in the request page

  var requestOrganisationSelect = document.querySelector('#request-organization select');

  if (requestOrganisationSelect) {
    requestOrganisationSelect.addEventListener('change', function () {
      closest(this, 'form').submit();
    });
  } // If multibrand search has more than 5 help centers or categories collapse the list


  var multibrandFilterLists = document.querySelectorAll('.multibrand-filter-list');
  Array.prototype.forEach.call(multibrandFilterLists, function (filter) {
    if (filter.children.length > 6) {
      // Display the show more button
      var trigger = filter.querySelector('.see-all-filters');
      trigger.setAttribute('aria-hidden', false); // Add event handler for click

      trigger.addEventListener('click', function (e) {
        e.stopPropagation();
        trigger.parentNode.removeChild(trigger);
        filter.classList.remove('multibrand-filter-list--collapsed');
      });
    }
  }); // If there are any error notifications below an input field, focus that field

  var notificationElm = document.querySelector('.notification-error');

  if (notificationElm && notificationElm.previousElementSibling && typeof notificationElm.previousElementSibling.focus === 'function') {
    notificationElm.previousElementSibling.focus();
  } // Dropdowns


  function Dropdown(toggle, menu) {
    this.toggle = toggle;
    this.menu = menu;
    this.menuPlacement = {
      top: menu.classList.contains('dropdown-menu-top'),
      end: menu.classList.contains('dropdown-menu-end')
    };
    this.toggle.addEventListener('click', this.clickHandler.bind(this));
    this.toggle.addEventListener('keydown', this.toggleKeyHandler.bind(this));
    this.menu.addEventListener('keydown', this.menuKeyHandler.bind(this));
  }

  Dropdown.prototype = {
    get isExpanded() {
      return this.menu.getAttribute('aria-expanded') === 'true';
    },

    get menuItems() {
      return Array.prototype.slice.call(this.menu.querySelectorAll("[role='menuitem']"));
    },

    dismiss: function dismiss() {
      if (!this.isExpanded) return;
      this.menu.setAttribute('aria-expanded', false);
      this.menu.classList.remove('dropdown-menu-end', 'dropdown-menu-top');
    },
    open: function open() {
      if (this.isExpanded) return;
      this.menu.setAttribute('aria-expanded', true);
      this.handleOverflow();
    },
    handleOverflow: function handleOverflow() {
      var rect = this.menu.getBoundingClientRect();
      var overflow = {
        right: rect.left < 0 || rect.left + rect.width > window.innerWidth,
        bottom: rect.top < 0 || rect.top + rect.height > window.innerHeight
      };

      if (overflow.right || this.menuPlacement.end) {
        this.menu.classList.add('dropdown-menu-end');
      }

      if (overflow.bottom || this.menuPlacement.top) {
        this.menu.classList.add('dropdown-menu-top');
      }

      if (this.menu.getBoundingClientRect().top < 0) {
        this.menu.classList.remove('dropdown-menu-top');
      }
    },
    focusNextMenuItem: function focusNextMenuItem(currentItem) {
      if (!this.menuItems.length) return;
      var currentIndex = this.menuItems.indexOf(currentItem);
      var nextIndex = currentIndex === this.menuItems.length - 1 || currentIndex < 0 ? 0 : currentIndex + 1;
      this.menuItems[nextIndex].focus();
    },
    focusPreviousMenuItem: function focusPreviousMenuItem(currentItem) {
      if (!this.menuItems.length) return;
      var currentIndex = this.menuItems.indexOf(currentItem);
      var previousIndex = currentIndex <= 0 ? this.menuItems.length - 1 : currentIndex - 1;
      this.menuItems[previousIndex].focus();
    },
    clickHandler: function clickHandler() {
      if (this.isExpanded) {
        this.dismiss();
      } else {
        this.open();
      }
    },
    toggleKeyHandler: function toggleKeyHandler(e) {
      switch (e.keyCode) {
        case ENTER:
        case SPACE:
        case DOWN:
          e.preventDefault();
          this.open();
          this.focusNextMenuItem();
          break;

        case UP:
          e.preventDefault();
          this.open();
          this.focusPreviousMenuItem();
          break;

        case ESCAPE:
          this.dismiss();
          this.toggle.focus();
          break;
      }
    },
    menuKeyHandler: function menuKeyHandler(e) {
      var firstItem = this.menuItems[0];
      var lastItem = this.menuItems[this.menuItems.length - 1];
      var currentElement = e.target;

      switch (e.keyCode) {
        case ESCAPE:
          this.dismiss();
          this.toggle.focus();
          break;

        case DOWN:
          e.preventDefault();
          this.focusNextMenuItem(currentElement);
          break;

        case UP:
          e.preventDefault();
          this.focusPreviousMenuItem(currentElement);
          break;

        case TAB:
          if (e.shiftKey) {
            if (currentElement === firstItem) {
              this.dismiss();
            } else {
              e.preventDefault();
              this.focusPreviousMenuItem(currentElement);
            }
          } else if (currentElement === lastItem) {
            this.dismiss();
          } else {
            e.preventDefault();
            this.focusNextMenuItem(currentElement);
          }

          break;

        case ENTER:
        case SPACE:
          e.preventDefault();
          currentElement.click();
          break;
      }
    }
  };
  var dropdowns = [];
  var dropdownToggles = Array.prototype.slice.call(document.querySelectorAll('.dropdown-toggle'));
  dropdownToggles.forEach(function (toggle) {
    var menu = toggle.nextElementSibling;

    if (menu && menu.classList.contains('dropdown-menu')) {
      dropdowns.push(new Dropdown(toggle, menu));
    }
  });
  document.addEventListener('click', function (evt) {
    dropdowns.forEach(function (dropdown) {
      if (!dropdown.toggle.contains(evt.target)) {
        dropdown.dismiss();
      }
    });
  });
});
document.addEventListener('DOMContentLoaded', function () {
  // hide menu to footer
  (function () {
    var footerNavList = document.querySelector('.site-footer__nav-list');
    if (!footerNavList) return;
    var VISBLE_ITEMS = 9;
    var submenus = document.querySelectorAll('.site-footer__nav-list > li');
    var pageLang = document.documentElement.getAttribute('lang');

    function createButton() {
      var btn = document.createElement('button');
      var label;

      switch (pageLang) {
        case 'ru':
          label = 'и другое!';
          break;

        case 'es':
          label = '¡y más!';
          break;

        default:
          label = 'and more';
      }

      btn.textContent = label;
      btn.classList = 'site-footer__nav-more';
      btn.addEventListener('click', function (evt) {
        evt.preventDefault();
        showItemsOfMenu(evt.currentTarget.parentElement);
        evt.currentTarget.remove();
      });
      return btn;
    }

    function showItemsOfMenu(submenu) {
      var items = submenu.querySelectorAll('li');

      for (var i = 0; i < items.length; i++) {
        items[i].style.display = 'list-item';
      }
    }

    function hideItemsOfMenu(submenu) {
      var items = submenu.querySelectorAll('li');

      for (var i = 0; i < items.length; i++) {
        if (i >= VISBLE_ITEMS) {
          items[i].style.display = 'none';
        }
      }

      if (items.length > VISBLE_ITEMS) {
        submenu.append(createButton());
      }
    }

    submenus.forEach(function (submenu) {
      hideItemsOfMenu(submenu);
    });
  })();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRoZW1lLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJFTlRFUiIsIkVTQ0FQRSIsIlNQQUNFIiwiVVAiLCJET1dOIiwiVEFCIiwiY2xvc2VzdCIsImVsZW1lbnQiLCJzZWxlY3RvciIsIkVsZW1lbnQiLCJwcm90b3R5cGUiLCJtYXRjaGVzIiwibXNNYXRjaGVzU2VsZWN0b3IiLCJ3ZWJraXRNYXRjaGVzU2VsZWN0b3IiLCJwYXJlbnRFbGVtZW50IiwicGFyZW50Tm9kZSIsIm5vZGVUeXBlIiwiQXJyYXkiLCJmb3JFYWNoIiwiY2FsbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhbmNob3IiLCJlIiwicHJldmVudERlZmF1bHQiLCJ3aW5kb3ciLCJvcGVuIiwiaHJlZiIsInNhdmVGb2N1cyIsImFjdGl2ZUVsZW1lbnRJZCIsImFjdGl2ZUVsZW1lbnQiLCJnZXRBdHRyaWJ1dGUiLCJzZXNzaW9uU3RvcmFnZSIsInNldEl0ZW0iLCJyZXR1cm5Gb2N1c1RvIiwiZ2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJyZXR1cm5Gb2N1c1RvRWwiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJjb21tZW50Q29udGFpbmVyVGV4dGFyZWEiLCJjb21tZW50Q29udGFpbmVyRm9ybUNvbnRyb2xzIiwiZm9jdXNDb21tZW50Q29udGFpbmVyVGV4dGFyZWEiLCJzdHlsZSIsImRpc3BsYXkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwidmFsdWUiLCJzaG93UmVxdWVzdENvbW1lbnRDb250YWluZXJUcmlnZ2VyIiwicmVxdWVzdENvbW1lbnRGaWVsZHMiLCJyZXF1ZXN0Q29tbWVudFN1Ym1pdCIsInJlcXVlc3RNYXJrQXNTb2x2ZWRCdXR0b24iLCJyZXF1ZXN0TWFya0FzU29sdmVkQ2hlY2tib3giLCJyZXF1ZXN0Q29tbWVudFN1Ym1pdEJ1dHRvbiIsInNldEF0dHJpYnV0ZSIsImRpc2FibGVkIiwic3VibWl0IiwicmVxdWVzdENvbW1lbnRUZXh0YXJlYSIsInVzZXNXeXNpd3lnIiwiZGF0YXNldCIsImhlbHBlciIsImlzRW1wdHlQbGFpbnRleHQiLCJzIiwidHJpbSIsImlzRW1wdHlIdG1sIiwieG1sIiwiZG9jIiwiRE9NUGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwiaW1nIiwiY2hpbGRyZW4iLCJ0ZXh0Q29udGVudCIsImlzRW1wdHkiLCJpbm5lclRleHQiLCJlbCIsInN0b3BQcm9wYWdhdGlvbiIsInF1aWNrU2VhcmNoIiwia2V5Q29kZSIsInRvZ2dsZU5hdmlnYXRpb24iLCJ0b2dnbGUiLCJtZW51IiwiaXNFeHBhbmRlZCIsImNsb3NlTmF2aWdhdGlvbiIsImJ1cmdlck1lbnUiLCJ1c2VyTWVudSIsImxlbmd0aCIsImNvbGxhcHNpYmxlIiwicmVxdWVzdE9yZ2FuaXNhdGlvblNlbGVjdCIsIm11bHRpYnJhbmRGaWx0ZXJMaXN0cyIsImZpbHRlciIsInRyaWdnZXIiLCJyZW1vdmVDaGlsZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsIm5vdGlmaWNhdGlvbkVsbSIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJEcm9wZG93biIsIm1lbnVQbGFjZW1lbnQiLCJ0b3AiLCJjb250YWlucyIsImVuZCIsImNsaWNrSGFuZGxlciIsImJpbmQiLCJ0b2dnbGVLZXlIYW5kbGVyIiwibWVudUtleUhhbmRsZXIiLCJtZW51SXRlbXMiLCJzbGljZSIsImRpc21pc3MiLCJoYW5kbGVPdmVyZmxvdyIsInJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJvdmVyZmxvdyIsInJpZ2h0IiwibGVmdCIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImJvdHRvbSIsImhlaWdodCIsImlubmVySGVpZ2h0IiwiYWRkIiwiZm9jdXNOZXh0TWVudUl0ZW0iLCJjdXJyZW50SXRlbSIsImN1cnJlbnRJbmRleCIsImluZGV4T2YiLCJuZXh0SW5kZXgiLCJmb2N1c1ByZXZpb3VzTWVudUl0ZW0iLCJwcmV2aW91c0luZGV4IiwiZmlyc3RJdGVtIiwibGFzdEl0ZW0iLCJjdXJyZW50RWxlbWVudCIsInRhcmdldCIsInNoaWZ0S2V5IiwiY2xpY2siLCJkcm9wZG93bnMiLCJkcm9wZG93blRvZ2dsZXMiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJwdXNoIiwiZXZ0IiwiZHJvcGRvd24iLCJmb290ZXJOYXZMaXN0IiwiVklTQkxFX0lURU1TIiwic3VibWVudXMiLCJwYWdlTGFuZyIsImRvY3VtZW50RWxlbWVudCIsImNyZWF0ZUJ1dHRvbiIsImJ0biIsImNyZWF0ZUVsZW1lbnQiLCJsYWJlbCIsInNob3dJdGVtc09mTWVudSIsImN1cnJlbnRUYXJnZXQiLCJzdWJtZW51IiwiaXRlbXMiLCJpIiwiaGlkZUl0ZW1zT2ZNZW51IiwiYXBwZW5kIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxRQUFBLENBQUFDLGdCQUFBLENBQUEsa0JBQUEsRUFBQSxZQUFBO0FBQ0E7QUFDQSxNQUFBQyxLQUFBLEdBQUEsRUFBQTtBQUNBLE1BQUFDLE1BQUEsR0FBQSxFQUFBO0FBQ0EsTUFBQUMsS0FBQSxHQUFBLEVBQUE7QUFDQSxNQUFBQyxFQUFBLEdBQUEsRUFBQTtBQUNBLE1BQUFDLElBQUEsR0FBQSxFQUFBO0FBQ0EsTUFBQUMsR0FBQSxHQUFBLENBQUE7O0FBRUEsV0FBQUMsT0FBQSxDQUFBQyxPQUFBLEVBQUFDLFFBQUEsRUFBQTtBQUNBLFFBQUFDLE9BQUEsQ0FBQUMsU0FBQSxDQUFBSixPQUFBLEVBQUE7QUFDQSxhQUFBQyxPQUFBLENBQUFELE9BQUEsQ0FBQUUsUUFBQSxDQUFBO0FBQ0E7O0FBQ0EsT0FBQTtBQUNBLFVBQ0FDLE9BQUEsQ0FBQUMsU0FBQSxDQUFBQyxPQUFBLElBQUFKLE9BQUEsQ0FBQUksT0FBQSxDQUFBSCxRQUFBLENBQUEsSUFDQUMsT0FBQSxDQUFBQyxTQUFBLENBQUFFLGlCQUFBLElBQUFMLE9BQUEsQ0FBQUssaUJBQUEsQ0FBQUosUUFBQSxDQURBLElBRUFDLE9BQUEsQ0FBQUMsU0FBQSxDQUFBRyxxQkFBQSxJQUFBTixPQUFBLENBQUFNLHFCQUFBLENBQUFMLFFBQUEsQ0FI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b2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKCkge1xyXG4gIC8vIEtleSBtYXBcclxuICB2YXIgRU5URVIgPSAxMztcclxuICB2YXIgRVNDQVBFID0gMjc7XHJcbiAgdmFyIFNQQUNFID0gMzI7XHJcbiAgdmFyIFVQID0gMzg7XHJcbiAgdmFyIERPV04gPSA0MDtcclxuICB2YXIgVEFCID0gOTtcclxuXHJcbiAgZnVuY3Rpb24gY2xvc2VzdChlbGVtZW50LCBzZWxlY3Rvcikge1xyXG4gICAgaWYgKEVsZW1lbnQucHJvdG90eXBlLmNsb3Nlc3QpIHtcclxuICAgICAgcmV0dXJuIGVsZW1lbnQuY2xvc2VzdChzZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICBkbyB7XHJcbiAgICAgIGlmIChcclxuICAgICAgICAoRWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyAmJiBlbGVtZW50Lm1hdGNoZXMoc2VsZWN0b3IpKSB8fFxyXG4gICAgICAgIChFbGVtZW50LnByb3RvdHlwZS5tc01hdGNoZXNTZWxlY3RvciAmJiBlbGVtZW50Lm1zTWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKSkgfHxcclxuICAgICAgICAoRWxlbWVudC5wcm90b3R5cGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yICYmIGVsZW1lbnQud2Via2l0TWF0Y2hlc1NlbGVjdG9yKHNlbGVjdG9yKSlcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICAgIH1cclxuICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50RWxlbWVudCB8fCBlbGVtZW50LnBhcmVudE5vZGU7XHJcbiAgICB9IHdoaWxlIChlbGVtZW50ICE9PSBudWxsICYmIGVsZW1lbnQubm9kZVR5cGUgPT09IDEpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvLyBzb2NpYWwgc2hhcmUgcG9wdXBzXHJcbiAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2hhcmUgYScpLCBmdW5jdGlvbiAoYW5jaG9yKSB7XHJcbiAgICBhbmNob3IuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHdpbmRvdy5vcGVuKHRoaXMuaHJlZiwgJycsICdoZWlnaHQgPSA1MDAsIHdpZHRoID0gNTAwJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgLy8gSW4gc29tZSBjYXNlcyB3ZSBzaG91bGQgcHJlc2VydmUgZm9jdXMgYWZ0ZXIgcGFnZSByZWxvYWRcclxuICBmdW5jdGlvbiBzYXZlRm9jdXMoKSB7XHJcbiAgICB2YXIgYWN0aXZlRWxlbWVudElkID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJyk7XHJcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdyZXR1cm5Gb2N1c1RvJywgJyMnICsgYWN0aXZlRWxlbWVudElkKTtcclxuICB9XHJcbiAgdmFyIHJldHVybkZvY3VzVG8gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdyZXR1cm5Gb2N1c1RvJyk7XHJcbiAgaWYgKHJldHVybkZvY3VzVG8pIHtcclxuICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3JldHVybkZvY3VzVG8nKTtcclxuICAgIHZhciByZXR1cm5Gb2N1c1RvRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHJldHVybkZvY3VzVG8pO1xyXG4gICAgcmV0dXJuRm9jdXNUb0VsICYmIHJldHVybkZvY3VzVG9FbC5mb2N1cyAmJiByZXR1cm5Gb2N1c1RvRWwuZm9jdXMoKTtcclxuICB9XHJcblxyXG4gIC8vIHNob3cgZm9ybSBjb250cm9scyB3aGVuIHRoZSB0ZXh0YXJlYSByZWNlaXZlcyBmb2N1cyBvciBiYWNrYnV0dG9uIGlzIHVzZWQgYW5kIHZhbHVlIGV4aXN0c1xyXG4gIHZhciBjb21tZW50Q29udGFpbmVyVGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tbWVudC1jb250YWluZXIgdGV4dGFyZWEnKSxcclxuICAgIGNvbW1lbnRDb250YWluZXJGb3JtQ29udHJvbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tbWVudC1mb3JtLWNvbnRyb2xzLCAuY29tbWVudC1jY3MnKTtcclxuXHJcbiAgaWYgKGNvbW1lbnRDb250YWluZXJUZXh0YXJlYSkge1xyXG4gICAgY29tbWVudENvbnRhaW5lclRleHRhcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZnVuY3Rpb24gZm9jdXNDb21tZW50Q29udGFpbmVyVGV4dGFyZWEoKSB7XHJcbiAgICAgIGNvbW1lbnRDb250YWluZXJGb3JtQ29udHJvbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgIGNvbW1lbnRDb250YWluZXJUZXh0YXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIGZvY3VzQ29tbWVudENvbnRhaW5lclRleHRhcmVhKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChjb21tZW50Q29udGFpbmVyVGV4dGFyZWEudmFsdWUgIT09ICcnKSB7XHJcbiAgICAgIGNvbW1lbnRDb250YWluZXJGb3JtQ29udHJvbHMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBFeHBhbmQgUmVxdWVzdCBjb21tZW50IGZvcm0gd2hlbiBBZGQgdG8gY29udmVyc2F0aW9uIGlzIGNsaWNrZWRcclxuICB2YXIgc2hvd1JlcXVlc3RDb21tZW50Q29udGFpbmVyVHJpZ2dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICcucmVxdWVzdC1jb250YWluZXIgLmNvbW1lbnQtY29udGFpbmVyIC5jb21tZW50LXNob3ctY29udGFpbmVyJ1xyXG4gICAgKSxcclxuICAgIHJlcXVlc3RDb21tZW50RmllbGRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlcXVlc3QtY29udGFpbmVyIC5jb21tZW50LWNvbnRhaW5lciAuY29tbWVudC1maWVsZHMnKSxcclxuICAgIHJlcXVlc3RDb21tZW50U3VibWl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlcXVlc3QtY29udGFpbmVyIC5jb21tZW50LWNvbnRhaW5lciAucmVxdWVzdC1zdWJtaXQtY29tbWVudCcpO1xyXG5cclxuICBpZiAoc2hvd1JlcXVlc3RDb21tZW50Q29udGFpbmVyVHJpZ2dlcikge1xyXG4gICAgc2hvd1JlcXVlc3RDb21tZW50Q29udGFpbmVyVHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgc2hvd1JlcXVlc3RDb21tZW50Q29udGFpbmVyVHJpZ2dlci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKHJlcXVlc3RDb21tZW50RmllbGRzLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXF1ZXN0Q29tbWVudFN1Ym1pdC5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7XHJcblxyXG4gICAgICBpZiAoY29tbWVudENvbnRhaW5lclRleHRhcmVhKSB7XHJcbiAgICAgICAgY29tbWVudENvbnRhaW5lclRleHRhcmVhLmZvY3VzKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gTWFyayBhcyBzb2x2ZWQgYnV0dG9uXHJcbiAgdmFyIHJlcXVlc3RNYXJrQXNTb2x2ZWRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVxdWVzdC1jb250YWluZXIgLm1hcmstYXMtc29sdmVkOm5vdChbZGF0YS1kaXNhYmxlZF0pJyksXHJcbiAgICByZXF1ZXN0TWFya0FzU29sdmVkQ2hlY2tib3ggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVxdWVzdC1jb250YWluZXIgLmNvbW1lbnQtY29udGFpbmVyIGlucHV0W3R5cGU9Y2hlY2tib3hdJyksXHJcbiAgICByZXF1ZXN0Q29tbWVudFN1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXF1ZXN0LWNvbnRhaW5lciAuY29tbWVudC1jb250YWluZXIgaW5wdXRbdHlwZT1zdWJtaXRdJyk7XHJcblxyXG4gIGlmIChyZXF1ZXN0TWFya0FzU29sdmVkQnV0dG9uKSB7XHJcbiAgICByZXF1ZXN0TWFya0FzU29sdmVkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICByZXF1ZXN0TWFya0FzU29sdmVkQ2hlY2tib3guc2V0QXR0cmlidXRlKCdjaGVja2VkJywgdHJ1ZSk7XHJcbiAgICAgIHJlcXVlc3RDb21tZW50U3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoJ2RhdGEtZGlzYWJsZWQnLCB0cnVlKTtcclxuICAgICAgLy8gRWxlbWVudC5jbG9zZXN0IGlzIG5vdCBzdXBwb3J0ZWQgaW4gSUUxMVxyXG4gICAgICBjbG9zZXN0KHRoaXMsICdmb3JtJykuc3VibWl0KCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIENoYW5nZSBNYXJrIGFzIHNvbHZlZCB0ZXh0IGFjY29yZGluZyB0byB3aGV0aGVyIGNvbW1lbnQgaXMgZmlsbGVkXHJcbiAgdmFyIHJlcXVlc3RDb21tZW50VGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVxdWVzdC1jb250YWluZXIgLmNvbW1lbnQtY29udGFpbmVyIHRleHRhcmVhJyk7XHJcblxyXG4gIHZhciB1c2VzV3lzaXd5ZyA9IHJlcXVlc3RDb21tZW50VGV4dGFyZWEgJiYgcmVxdWVzdENvbW1lbnRUZXh0YXJlYS5kYXRhc2V0LmhlbHBlciA9PT0gJ3d5c2l3eWcnO1xyXG5cclxuICBmdW5jdGlvbiBpc0VtcHR5UGxhaW50ZXh0KHMpIHtcclxuICAgIHJldHVybiBzLnRyaW0oKSA9PT0gJyc7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBpc0VtcHR5SHRtbCh4bWwpIHtcclxuICAgIHZhciBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGA8Xz4ke3htbH08L18+YCwgJ3RleHQveG1sJyk7XHJcbiAgICB2YXIgaW1nID0gZG9jLnF1ZXJ5U2VsZWN0b3IoJ2ltZycpO1xyXG4gICAgcmV0dXJuIGltZyA9PT0gbnVsbCAmJiBpc0VtcHR5UGxhaW50ZXh0KGRvYy5jaGlsZHJlblswXS50ZXh0Q29udGVudCk7XHJcbiAgfVxyXG5cclxuICB2YXIgaXNFbXB0eSA9IHVzZXNXeXNpd3lnID8gaXNFbXB0eUh0bWwgOiBpc0VtcHR5UGxhaW50ZXh0O1xyXG5cclxuICBpZiAocmVxdWVzdENvbW1lbnRUZXh0YXJlYSkge1xyXG4gICAgcmVxdWVzdENvbW1lbnRUZXh0YXJlYS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKGlzRW1wdHkocmVxdWVzdENvbW1lbnRUZXh0YXJlYS52YWx1ZSkpIHtcclxuICAgICAgICBpZiAocmVxdWVzdE1hcmtBc1NvbHZlZEJ1dHRvbikge1xyXG4gICAgICAgICAgcmVxdWVzdE1hcmtBc1NvbHZlZEJ1dHRvbi5pbm5lclRleHQgPSByZXF1ZXN0TWFya0FzU29sdmVkQnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS1zb2x2ZS10cmFuc2xhdGlvbicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXF1ZXN0Q29tbWVudFN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgaWYgKHJlcXVlc3RNYXJrQXNTb2x2ZWRCdXR0b24pIHtcclxuICAgICAgICAgIHJlcXVlc3RNYXJrQXNTb2x2ZWRCdXR0b24uaW5uZXJUZXh0ID0gcmVxdWVzdE1hcmtBc1NvbHZlZEJ1dHRvbi5nZXRBdHRyaWJ1dGUoXHJcbiAgICAgICAgICAgICdkYXRhLXNvbHZlLWFuZC1zdWJtaXQtdHJhbnNsYXRpb24nXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXF1ZXN0Q29tbWVudFN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIERpc2FibGUgc3VibWl0IGJ1dHRvbiBpZiB0ZXh0YXJlYSBpcyBlbXB0eVxyXG4gIGlmIChyZXF1ZXN0Q29tbWVudFRleHRhcmVhICYmIGlzRW1wdHkocmVxdWVzdENvbW1lbnRUZXh0YXJlYS52YWx1ZSkpIHtcclxuICAgIHJlcXVlc3RDb21tZW50U3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICB9XHJcblxyXG4gIC8vIFN1Ym1pdCByZXF1ZXN0cyBmaWx0ZXIgZm9ybSBvbiBzdGF0dXMgb3Igb3JnYW5pemF0aW9uIGNoYW5nZSBpbiB0aGUgcmVxdWVzdCBsaXN0IHBhZ2VcclxuICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKFxyXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI3JlcXVlc3Qtc3RhdHVzLXNlbGVjdCwgI3JlcXVlc3Qtb3JnYW5pemF0aW9uLXNlbGVjdCcpLFxyXG4gICAgZnVuY3Rpb24gKGVsKSB7XHJcbiAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBzYXZlRm9jdXMoKTtcclxuICAgICAgICBjbG9zZXN0KHRoaXMsICdmb3JtJykuc3VibWl0KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICk7XHJcblxyXG4gIC8vIFN1Ym1pdCByZXF1ZXN0cyBmaWx0ZXIgZm9ybSBvbiBzZWFyY2ggaW4gdGhlIHJlcXVlc3QgbGlzdCBwYWdlXHJcbiAgdmFyIHF1aWNrU2VhcmNoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3F1aWNrLXNlYXJjaCcpO1xyXG4gIHF1aWNrU2VhcmNoICYmXHJcbiAgICBxdWlja1NlYXJjaC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGlmIChlLmtleUNvZGUgPT09IEVOVEVSKSB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBzYXZlRm9jdXMoKTtcclxuICAgICAgICBjbG9zZXN0KHRoaXMsICdmb3JtJykuc3VibWl0KCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICBmdW5jdGlvbiB0b2dnbGVOYXZpZ2F0aW9uKHRvZ2dsZSwgbWVudSkge1xyXG4gICAgdmFyIGlzRXhwYW5kZWQgPSBtZW51LmdldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcpID09PSAndHJ1ZSc7XHJcbiAgICBtZW51LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsICFpc0V4cGFuZGVkKTtcclxuICAgIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAhaXNFeHBhbmRlZCk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjbG9zZU5hdmlnYXRpb24odG9nZ2xlLCBtZW51KSB7XHJcbiAgICBtZW51LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGZhbHNlKTtcclxuICAgIHRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7XHJcbiAgICB0b2dnbGUuZm9jdXMoKTtcclxuICB9XHJcblxyXG4gIHZhciBidXJnZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlciAubWVudS1idXR0b24nKTtcclxuICB2YXIgdXNlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1uYXYnKTtcclxuXHJcbiAgYnVyZ2VyTWVudS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgdG9nZ2xlTmF2aWdhdGlvbih0aGlzLCB1c2VyTWVudSk7XHJcbiAgfSk7XHJcblxyXG4gIHVzZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcclxuICAgIGlmIChlLmtleUNvZGUgPT09IEVTQ0FQRSkge1xyXG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICBjbG9zZU5hdmlnYXRpb24oYnVyZ2VyTWVudSwgdGhpcyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGlmICh1c2VyTWVudS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcclxuICAgIGJ1cmdlck1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICB9XHJcblxyXG4gIC8vIFRvZ2dsZXMgZXhwYW5kZWQgYXJpYSB0byBjb2xsYXBzaWJsZSBlbGVtZW50c1xyXG4gIHZhciBjb2xsYXBzaWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb2xsYXBzaWJsZS1uYXYsIC5jb2xsYXBzaWJsZS1zaWRlYmFyJyk7XHJcblxyXG4gIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoY29sbGFwc2libGUsIGZ1bmN0aW9uIChlbCkge1xyXG4gICAgdmFyIHRvZ2dsZSA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5jb2xsYXBzaWJsZS1uYXYtdG9nZ2xlLCAuY29sbGFwc2libGUtc2lkZWJhci10b2dnbGUnKTtcclxuXHJcbiAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIHRvZ2dsZU5hdmlnYXRpb24odG9nZ2xlLCB0aGlzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gRVNDQVBFKSB7XHJcbiAgICAgICAgY2xvc2VOYXZpZ2F0aW9uKHRvZ2dsZSwgdGhpcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICAvLyBTdWJtaXQgb3JnYW5pemF0aW9uIGZvcm0gaW4gdGhlIHJlcXVlc3QgcGFnZVxyXG4gIHZhciByZXF1ZXN0T3JnYW5pc2F0aW9uU2VsZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JlcXVlc3Qtb3JnYW5pemF0aW9uIHNlbGVjdCcpO1xyXG5cclxuICBpZiAocmVxdWVzdE9yZ2FuaXNhdGlvblNlbGVjdCkge1xyXG4gICAgcmVxdWVzdE9yZ2FuaXNhdGlvblNlbGVjdC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNsb3Nlc3QodGhpcywgJ2Zvcm0nKS5zdWJtaXQoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gSWYgbXVsdGlicmFuZCBzZWFyY2ggaGFzIG1vcmUgdGhhbiA1IGhlbHAgY2VudGVycyBvciBjYXRlZ29yaWVzIGNvbGxhcHNlIHRoZSBsaXN0XHJcbiAgdmFyIG11bHRpYnJhbmRGaWx0ZXJMaXN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tdWx0aWJyYW5kLWZpbHRlci1saXN0Jyk7XHJcbiAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChtdWx0aWJyYW5kRmlsdGVyTGlzdHMsIGZ1bmN0aW9uIChmaWx0ZXIpIHtcclxuICAgIGlmIChmaWx0ZXIuY2hpbGRyZW4ubGVuZ3RoID4gNikge1xyXG4gICAgICAvLyBEaXNwbGF5IHRoZSBzaG93IG1vcmUgYnV0dG9uXHJcbiAgICAgIHZhciB0cmlnZ2VyID0gZmlsdGVyLnF1ZXJ5U2VsZWN0b3IoJy5zZWUtYWxsLWZpbHRlcnMnKTtcclxuICAgICAgdHJpZ2dlci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgZmFsc2UpO1xyXG5cclxuICAgICAgLy8gQWRkIGV2ZW50IGhhbmRsZXIgZm9yIGNsaWNrXHJcbiAgICAgIHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdHJpZ2dlci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRyaWdnZXIpO1xyXG4gICAgICAgIGZpbHRlci5jbGFzc0xpc3QucmVtb3ZlKCdtdWx0aWJyYW5kLWZpbHRlci1saXN0LS1jb2xsYXBzZWQnKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIC8vIElmIHRoZXJlIGFyZSBhbnkgZXJyb3Igbm90aWZpY2F0aW9ucyBiZWxvdyBhbiBpbnB1dCBmaWVsZCwgZm9jdXMgdGhhdCBmaWVsZFxyXG4gIHZhciBub3RpZmljYXRpb25FbG0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubm90aWZpY2F0aW9uLWVycm9yJyk7XHJcbiAgaWYgKFxyXG4gICAgbm90aWZpY2F0aW9uRWxtICYmXHJcbiAgICBub3RpZmljYXRpb25FbG0ucHJldmlvdXNFbGVtZW50U2libGluZyAmJlxyXG4gICAgdHlwZW9mIG5vdGlmaWNhdGlvbkVsbS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLmZvY3VzID09PSAnZnVuY3Rpb24nXHJcbiAgKSB7XHJcbiAgICBub3RpZmljYXRpb25FbG0ucHJldmlvdXNFbGVtZW50U2libGluZy5mb2N1cygpO1xyXG4gIH1cclxuXHJcbiAgLy8gRHJvcGRvd25zXHJcblxyXG4gIGZ1bmN0aW9uIERyb3Bkb3duKHRvZ2dsZSwgbWVudSkge1xyXG4gICAgdGhpcy50b2dnbGUgPSB0b2dnbGU7XHJcbiAgICB0aGlzLm1lbnUgPSBtZW51O1xyXG5cclxuICAgIHRoaXMubWVudVBsYWNlbWVudCA9IHtcclxuICAgICAgdG9wOiBtZW51LmNsYXNzTGlzdC5jb250YWlucygnZHJvcGRvd24tbWVudS10b3AnKSxcclxuICAgICAgZW5kOiBtZW51LmNsYXNzTGlzdC5jb250YWlucygnZHJvcGRvd24tbWVudS1lbmQnKSxcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy50b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrSGFuZGxlci5iaW5kKHRoaXMpKTtcclxuICAgIHRoaXMudG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLnRvZ2dsZUtleUhhbmRsZXIuYmluZCh0aGlzKSk7XHJcbiAgICB0aGlzLm1lbnUuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHRoaXMubWVudUtleUhhbmRsZXIuYmluZCh0aGlzKSk7XHJcbiAgfVxyXG5cclxuICBEcm9wZG93bi5wcm90b3R5cGUgPSB7XHJcbiAgICBnZXQgaXNFeHBhbmRlZCgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMubWVudS5nZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnKSA9PT0gJ3RydWUnO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXQgbWVudUl0ZW1zKCkge1xyXG4gICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcy5tZW51LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbcm9sZT0nbWVudWl0ZW0nXVwiKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGRpc21pc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKCF0aGlzLmlzRXhwYW5kZWQpIHJldHVybjtcclxuXHJcbiAgICAgIHRoaXMubWVudS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7XHJcbiAgICAgIHRoaXMubWVudS5jbGFzc0xpc3QucmVtb3ZlKCdkcm9wZG93bi1tZW51LWVuZCcsICdkcm9wZG93bi1tZW51LXRvcCcpO1xyXG4gICAgfSxcclxuXHJcbiAgICBvcGVuOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmICh0aGlzLmlzRXhwYW5kZWQpIHJldHVybjtcclxuXHJcbiAgICAgIHRoaXMubWVudS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcclxuICAgICAgdGhpcy5oYW5kbGVPdmVyZmxvdygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBoYW5kbGVPdmVyZmxvdzogZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgcmVjdCA9IHRoaXMubWVudS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAgIHZhciBvdmVyZmxvdyA9IHtcclxuICAgICAgICByaWdodDogcmVjdC5sZWZ0IDwgMCB8fCByZWN0LmxlZnQgKyByZWN0LndpZHRoID4gd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgYm90dG9tOiByZWN0LnRvcCA8IDAgfHwgcmVjdC50b3AgKyByZWN0LmhlaWdodCA+IHdpbmRvdy5pbm5lckhlaWdodCxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmIChvdmVyZmxvdy5yaWdodCB8fCB0aGlzLm1lbnVQbGFjZW1lbnQuZW5kKSB7XHJcbiAgICAgICAgdGhpcy5tZW51LmNsYXNzTGlzdC5hZGQoJ2Ryb3Bkb3duLW1lbnUtZW5kJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChvdmVyZmxvdy5ib3R0b20gfHwgdGhpcy5tZW51UGxhY2VtZW50LnRvcCkge1xyXG4gICAgICAgIHRoaXMubWVudS5jbGFzc0xpc3QuYWRkKCdkcm9wZG93bi1tZW51LXRvcCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5tZW51LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA8IDApIHtcclxuICAgICAgICB0aGlzLm1lbnUuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcGRvd24tbWVudS10b3AnKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBmb2N1c05leHRNZW51SXRlbTogZnVuY3Rpb24gKGN1cnJlbnRJdGVtKSB7XHJcbiAgICAgIGlmICghdGhpcy5tZW51SXRlbXMubGVuZ3RoKSByZXR1cm47XHJcblxyXG4gICAgICB2YXIgY3VycmVudEluZGV4ID0gdGhpcy5tZW51SXRlbXMuaW5kZXhPZihjdXJyZW50SXRlbSk7XHJcbiAgICAgIHZhciBuZXh0SW5kZXggPSBjdXJyZW50SW5kZXggPT09IHRoaXMubWVudUl0ZW1zLmxlbmd0aCAtIDEgfHwgY3VycmVudEluZGV4IDwgMCA/IDAgOiBjdXJyZW50SW5kZXggKyAxO1xyXG5cclxuICAgICAgdGhpcy5tZW51SXRlbXNbbmV4dEluZGV4XS5mb2N1cygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBmb2N1c1ByZXZpb3VzTWVudUl0ZW06IGZ1bmN0aW9uIChjdXJyZW50SXRlbSkge1xyXG4gICAgICBpZiAoIXRoaXMubWVudUl0ZW1zLmxlbmd0aCkgcmV0dXJuO1xyXG5cclxuICAgICAgdmFyIGN1cnJlbnRJbmRleCA9IHRoaXMubWVudUl0ZW1zLmluZGV4T2YoY3VycmVudEl0ZW0pO1xyXG4gICAgICB2YXIgcHJldmlvdXNJbmRleCA9IGN1cnJlbnRJbmRleCA8PSAwID8gdGhpcy5tZW51SXRlbXMubGVuZ3RoIC0gMSA6IGN1cnJlbnRJbmRleCAtIDE7XHJcblxyXG4gICAgICB0aGlzLm1lbnVJdGVtc1twcmV2aW91c0luZGV4XS5mb2N1cygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBjbGlja0hhbmRsZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKHRoaXMuaXNFeHBhbmRlZCkge1xyXG4gICAgICAgIHRoaXMuZGlzbWlzcygpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMub3BlbigpO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHRvZ2dsZUtleUhhbmRsZXI6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgY2FzZSBFTlRFUjpcclxuICAgICAgICBjYXNlIFNQQUNFOlxyXG4gICAgICAgIGNhc2UgRE9XTjpcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIHRoaXMub3BlbigpO1xyXG4gICAgICAgICAgdGhpcy5mb2N1c05leHRNZW51SXRlbSgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVUDpcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIHRoaXMub3BlbigpO1xyXG4gICAgICAgICAgdGhpcy5mb2N1c1ByZXZpb3VzTWVudUl0ZW0oKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRVNDQVBFOlxyXG4gICAgICAgICAgdGhpcy5kaXNtaXNzKCk7XHJcbiAgICAgICAgICB0aGlzLnRvZ2dsZS5mb2N1cygpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgbWVudUtleUhhbmRsZXI6IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIHZhciBmaXJzdEl0ZW0gPSB0aGlzLm1lbnVJdGVtc1swXTtcclxuICAgICAgdmFyIGxhc3RJdGVtID0gdGhpcy5tZW51SXRlbXNbdGhpcy5tZW51SXRlbXMubGVuZ3RoIC0gMV07XHJcbiAgICAgIHZhciBjdXJyZW50RWxlbWVudCA9IGUudGFyZ2V0O1xyXG5cclxuICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgICBjYXNlIEVTQ0FQRTpcclxuICAgICAgICAgIHRoaXMuZGlzbWlzcygpO1xyXG4gICAgICAgICAgdGhpcy50b2dnbGUuZm9jdXMoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgRE9XTjpcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIHRoaXMuZm9jdXNOZXh0TWVudUl0ZW0oY3VycmVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBVUDpcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIHRoaXMuZm9jdXNQcmV2aW91c01lbnVJdGVtKGN1cnJlbnRFbGVtZW50KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgVEFCOlxyXG4gICAgICAgICAgaWYgKGUuc2hpZnRLZXkpIHtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRFbGVtZW50ID09PSBmaXJzdEl0ZW0pIHtcclxuICAgICAgICAgICAgICB0aGlzLmRpc21pc3MoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgdGhpcy5mb2N1c1ByZXZpb3VzTWVudUl0ZW0oY3VycmVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRFbGVtZW50ID09PSBsYXN0SXRlbSkge1xyXG4gICAgICAgICAgICB0aGlzLmRpc21pc3MoKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5mb2N1c05leHRNZW51SXRlbShjdXJyZW50RWxlbWVudCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIEVOVEVSOlxyXG4gICAgICAgIGNhc2UgU1BBQ0U6XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICBjdXJyZW50RWxlbWVudC5jbGljaygpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgfTtcclxuXHJcbiAgdmFyIGRyb3Bkb3ducyA9IFtdO1xyXG4gIHZhciBkcm9wZG93blRvZ2dsZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZHJvcGRvd24tdG9nZ2xlJykpO1xyXG5cclxuICBkcm9wZG93blRvZ2dsZXMuZm9yRWFjaChmdW5jdGlvbiAodG9nZ2xlKSB7XHJcbiAgICB2YXIgbWVudSA9IHRvZ2dsZS5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICBpZiAobWVudSAmJiBtZW51LmNsYXNzTGlzdC5jb250YWlucygnZHJvcGRvd24tbWVudScpKSB7XHJcbiAgICAgIGRyb3Bkb3ducy5wdXNoKG5ldyBEcm9wZG93bih0b2dnbGUsIG1lbnUpKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICBkcm9wZG93bnMuZm9yRWFjaChmdW5jdGlvbiAoZHJvcGRvd24pIHtcclxuICAgICAgaWYgKCFkcm9wZG93bi50b2dnbGUuY29udGFpbnMoZXZ0LnRhcmdldCkpIHtcclxuICAgICAgICBkcm9wZG93bi5kaXNtaXNzKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTtcclxuIiwiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgLy8gaGlkZSBtZW51IHRvIGZvb3RlclxuICAoZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGZvb3Rlck5hdkxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2l0ZS1mb290ZXJfX25hdi1saXN0Jyk7XG5cbiAgICBpZiAoIWZvb3Rlck5hdkxpc3QpIHJldHVybjtcblxuICAgIGNvbnN0IFZJU0JMRV9JVEVNUyA9IDk7XG4gICAgY29uc3Qgc3VibWVudXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2l0ZS1mb290ZXJfX25hdi1saXN0ID4gbGknKTtcbiAgICBjb25zdCBwYWdlTGFuZyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xhbmcnKTtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbigpIHtcbiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICAgICAgbGV0IGxhYmVsO1xuXG4gICAgICBzd2l0Y2ggKHBhZ2VMYW5nKSB7XG4gICAgICAgIGNhc2UgJ3J1JzpcbiAgICAgICAgICBsYWJlbCA9ICfQuCDQtNGA0YPQs9C+0LUhJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZXMnOlxuICAgICAgICAgIGxhYmVsID0gJ8KheSBtw6FzISc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgbGFiZWwgPSAnYW5kIG1vcmUnO1xuICAgICAgfVxuXG4gICAgICBidG4udGV4dENvbnRlbnQgPSBsYWJlbDtcbiAgICAgIGJ0bi5jbGFzc0xpc3QgPSAnc2l0ZS1mb290ZXJfX25hdi1tb3JlJztcblxuICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBzaG93SXRlbXNPZk1lbnUoZXZ0LmN1cnJlbnRUYXJnZXQucGFyZW50RWxlbWVudCk7XG4gICAgICAgIGV2dC5jdXJyZW50VGFyZ2V0LnJlbW92ZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBidG47XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0l0ZW1zT2ZNZW51KHN1Ym1lbnUpIHtcbiAgICAgIGNvbnN0IGl0ZW1zID0gc3VibWVudS5xdWVyeVNlbGVjdG9yQWxsKCdsaScpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGl0ZW1zW2ldLnN0eWxlLmRpc3BsYXkgPSAnbGlzdC1pdGVtJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlSXRlbXNPZk1lbnUoc3VibWVudSkge1xuICAgICAgY29uc3QgaXRlbXMgPSBzdWJtZW51LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGkgPj0gVklTQkxFX0lURU1TKSB7XG4gICAgICAgICAgaXRlbXNbaV0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbXMubGVuZ3RoID4gVklTQkxFX0lURU1TKSB7XG4gICAgICAgIHN1Ym1lbnUuYXBwZW5kKGNyZWF0ZUJ1dHRvbigpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzdWJtZW51cy5mb3JFYWNoKChzdWJtZW51KSA9PiB7XG4gICAgICBoaWRlSXRlbXNPZk1lbnUoc3VibWVudSk7XG4gICAgfSk7XG4gIH0pKCk7XG59KTtcbiJdfQ==
